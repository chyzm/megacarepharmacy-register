<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrant Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            text-align: center;
        }
        .detail-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
        }
        .detail-label {
            font-weight: bold;
            min-width: 120px;
            color: #3498db;
        }
        .detail-value {
            flex: 1;
        }
        .error-message {
            color: #e74c3c;
            text-align: center;
            margin-top: 30px;
        }
        .loading-message {
            text-align: center;
            color: #7f8c8d;
        }
        .qr-code-container {
            margin-top: 30px;
            text-align: center;
        }
        .btn-print {
            margin-top: 20px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Registrant Information</h1>
        <div id="details-container">
            <p class="loading-message">Loading details...</p>
        </div>
        <div id="qr-code-container" class="qr-code-container d-none">
            <h3>Your Registration QR Code</h3>
            <div id="qrcode"></div>
            <button class="btn btn-primary btn-print" onclick="window.print()">Print Details</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('id');
            const detailsContainer = document.getElementById('details-container');
            const qrCodeContainer = document.getElementById('qr-code-container');

            // Debug output
            console.log('URL Parameters:', urlParams.toString());
            console.log('User ID from URL:', userId);
            console.log('All localStorage keys:', Object.keys(localStorage));

            if (!userId) {
                detailsContainer.innerHTML = `
                    <div class="error-message">
                        <p>No registration ID found in the URL.</p>
                        <p>Please scan your QR code again or contact support.</p>
                    </div>
                `;
                return;
            }

            try {
                const registrantData = JSON.parse(localStorage.getItem(userId));
                
                if (!registrantData) {
                    detailsContainer.innerHTML = `
                        <div class="error-message">
                            <p>Registration data not found for ID: ${userId}</p>
                            <p>This may happen if:</p>
                            <ul>
                                <li>You're using a different browser or device</li>
                                <li>Your browser data was cleared</li>
                                <li>The QR code was generated on a different domain</li>
                            </ul>
                            <p>Please contact support for assistance.</p>
                        </div>
                    `;
                    return;
                }

                // Display registrant details
                detailsContainer.innerHTML = `
                    <div class="detail-item">
                        <span class="detail-label">First Name:</span>
                        <span class="detail-value">${registrantData.firstName || 'Not provided'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Last Name:</span>
                        <span class="detail-value">${registrantData.lastName || 'Not provided'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Email:</span>
                        <span class="detail-value">${registrantData.email || 'Not provided'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Mobile:</span>
                        <span class="detail-value">${registrantData.mobile || 'Not provided'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Job Title:</span>
                        <span class="detail-value">${registrantData.jobTitle || 'Not provided'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Company:</span>
                        <span class="detail-value">${registrantData.company || 'Not provided'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">City:</span>
                        <span class="detail-value">${registrantData.city || 'Not provided'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Country:</span>
                        <span class="detail-value">${registrantData.country || 'Not provided'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Registration Date:</span>
                        <span class="detail-value">${new Date(registrantData.registrationDate).toLocaleString() || 'Unknown'}</span>
                    </div>
                `;

                // Generate QR code for the current URL
                const currentUrl = window.location.href;
                const qrCodeImg = document.createElement('img');
                qrCodeImg.src = `https://api.qrcode-monkey.com/qr/custom?size=200&data=${encodeURIComponent(currentUrl)}`;
                qrCodeImg.alt = "Registration QR Code";
                qrCodeImg.className = "img-fluid";
                document.getElementById('qrcode').appendChild(qrCodeImg);
                qrCodeContainer.classList.remove('d-none');

            } catch (error) {
                console.error('Error loading registration data:', error);
                detailsContainer.innerHTML = `
                    <div class="error-message">
                        <p>An error occurred while loading registration data.</p>
                        <p>Technical details: ${error.message}</p>
                        <p>Please contact support and provide the following ID: ${userId}</p>
                    </div>
                `;
            }
        });

        // Print styling
        const style = document.createElement('style');
        style.innerHTML = `
            @media print {
                body * {
                    visibility: hidden;
                }
                .container, .container * {
                    visibility: visible;
                }
                .container {
                    position: absolute;
                    left: 0;
                    top: 0;
                    width: 100%;
                    box-shadow: none;
                }
                .btn-print {
                    display: none;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>